{"ast":null,"code":"import _objectSpread from\"C:/Users/waghe/Desktop/crypto-portfolio/my-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState,useEffect}from\"react\";import API from\"../services/api\";import{Bell as BellIcon}from\"lucide-react\";import{io}from\"socket.io-client\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function NotificationBell(_ref){let{token,userId}=_ref;const[notifications,setNotifications]=useState([]);const[unreadCount,setUnreadCount]=useState(0);const[showDropdown,setShowDropdown]=useState(false);useEffect(()=>{const tokenLocal=token||localStorage.getItem(\"token\");if(!tokenLocal)return;const fetchNotifications=async()=>{try{const res=await API.get(\"/notifications\");setNotifications(res.data||[]);setUnreadCount((res.data||[]).filter(n=>!n.isRead).length);}catch(err){console.error(\"Error fetching notifications:\",err);}};fetchNotifications();const backendOrigin=(API.defaults&&API.defaults.baseURL?String(API.defaults.baseURL).replace(/\\/api\\/?$/,\"\"):\"\")||\"http://localhost:5000\";const socket=io(backendOrigin);socket.on(\"connect\",()=>{let uid=userId;if(!uid){try{const u=localStorage.getItem(\"user\");uid=u?JSON.parse(u)._id||JSON.parse(u).id:null;}catch(e){uid=null;}}if(uid)socket.emit(\"identify\",uid);});socket.on(\"newNotification\",notification=>{setNotifications(prev=>[notification,...prev]);setUnreadCount(prev=>prev+1);});return()=>socket.disconnect();},[token,userId]);const markAsRead=async id=>{try{await API.put(\"/notifications/\".concat(id,\"/read\"));setNotifications(prev=>prev.map(n=>n._id===id?_objectSpread(_objectSpread({},n),{},{isRead:true}):n));setUnreadCount(prev=>Math.max(0,prev-1));}catch(err){console.error(\"Error marking notification as read:\",err);}};const handleNotificationClick=n=>{if(!n.isRead)markAsRead(n._id);// future: navigate or open related item\n};return/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(BellIcon,{className:\"w-6 h-6 text-gray-700 cursor-pointer\",onClick:()=>setShowDropdown(!showDropdown)}),unreadCount>0&&/*#__PURE__*/_jsx(\"span\",{className:\"absolute top-0 right-0 bg-red-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs\",children:unreadCount}),showDropdown&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute right-0 mt-2 w-64 bg-white shadow-lg border rounded-md z-50 max-h-64 overflow-y-auto\",children:notifications.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"p-2 text-sm text-gray-500\",children:\"No notifications\"}):notifications.map(n=>/*#__PURE__*/_jsx(\"div\",{className:\"p-2 text-sm cursor-pointer hover:bg-gray-100 \".concat(!n.isRead?\"font-bold bg-gray-50\":\"\"),onClick:()=>handleNotificationClick(n),children:n.message},n._id))})]});}","map":{"version":3,"names":["useState","useEffect","API","Bell","BellIcon","io","jsx","_jsx","jsxs","_jsxs","NotificationBell","_ref","token","userId","notifications","setNotifications","unreadCount","setUnreadCount","showDropdown","setShowDropdown","tokenLocal","localStorage","getItem","fetchNotifications","res","get","data","filter","n","isRead","length","err","console","error","backendOrigin","defaults","baseURL","String","replace","socket","on","uid","u","JSON","parse","_id","id","e","emit","notification","prev","disconnect","markAsRead","put","concat","map","_objectSpread","Math","max","handleNotificationClick","className","children","onClick","message"],"sources":["C:/Users/waghe/Desktop/crypto-portfolio/my-app/src/components/NotificationBell.js"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport API from \"../services/api\";\r\nimport { Bell as BellIcon } from \"lucide-react\";\r\nimport { io } from \"socket.io-client\";\r\n\r\nexport default function NotificationBell({ token, userId }) {\r\n  const [notifications, setNotifications] = useState([]);\r\n  const [unreadCount, setUnreadCount] = useState(0);\r\n  const [showDropdown, setShowDropdown] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const tokenLocal = token || localStorage.getItem(\"token\");\r\n    if (!tokenLocal) return;\r\n\r\n    const fetchNotifications = async () => {\r\n      try {\r\n        const res = await API.get(\"/notifications\");\r\n        setNotifications(res.data || []);\r\n        setUnreadCount((res.data || []).filter((n) => !n.isRead).length);\r\n      } catch (err) {\r\n        console.error(\"Error fetching notifications:\", err);\r\n      }\r\n    };\r\n\r\n    fetchNotifications();\r\n\r\n    const backendOrigin = (API.defaults && API.defaults.baseURL\r\n      ? String(API.defaults.baseURL).replace(/\\/api\\/?$/, \"\")\r\n      : \"\") || \"http://localhost:5000\";\r\n\r\n    const socket = io(backendOrigin);\r\n\r\n    socket.on(\"connect\", () => {\r\n      let uid = userId;\r\n      if (!uid) {\r\n        try {\r\n          const u = localStorage.getItem(\"user\");\r\n          uid = u ? JSON.parse(u)._id || JSON.parse(u).id : null;\r\n        } catch (e) {\r\n          uid = null;\r\n        }\r\n      }\r\n      if (uid) socket.emit(\"identify\", uid);\r\n    });\r\n\r\n    socket.on(\"newNotification\", (notification) => {\r\n      setNotifications((prev) => [notification, ...prev]);\r\n      setUnreadCount((prev) => prev + 1);\r\n    });\r\n\r\n    return () => socket.disconnect();\r\n  }, [token, userId]);\r\n\r\n  const markAsRead = async (id) => {\r\n    try {\r\n      await API.put(`/notifications/${id}/read`);\r\n      setNotifications((prev) =>\r\n        prev.map((n) => (n._id === id ? { ...n, isRead: true } : n))\r\n      );\r\n      setUnreadCount((prev) => Math.max(0, prev - 1));\r\n    } catch (err) {\r\n      console.error(\"Error marking notification as read:\", err);\r\n    }\r\n  };\r\n\r\n  const handleNotificationClick = (n) => {\r\n    if (!n.isRead) markAsRead(n._id);\r\n    // future: navigate or open related item\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      <BellIcon\r\n        className=\"w-6 h-6 text-gray-700 cursor-pointer\"\r\n        onClick={() => setShowDropdown(!showDropdown)}\r\n      />\r\n      {unreadCount > 0 && (\r\n        <span className=\"absolute top-0 right-0 bg-red-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs\">\r\n          {unreadCount}\r\n        </span>\r\n      )}\r\n\r\n      {showDropdown && (\r\n        <div className=\"absolute right-0 mt-2 w-64 bg-white shadow-lg border rounded-md z-50 max-h-64 overflow-y-auto\">\r\n          {notifications.length === 0 ? (\r\n            <p className=\"p-2 text-sm text-gray-500\">No notifications</p>\r\n          ) : (\r\n            notifications.map((n) => (\r\n              <div\r\n                key={n._id}\r\n                className={`p-2 text-sm cursor-pointer hover:bg-gray-100 ${\r\n                  !n.isRead ? \"font-bold bg-gray-50\" : \"\"\r\n                }`}\r\n                onClick={() => handleNotificationClick(n)}\r\n              >\r\n                {n.message}\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"mappings":"mIAAA,OAASA,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC3C,MAAO,CAAAC,GAAG,KAAM,iBAAiB,CACjC,OAASC,IAAI,GAAI,CAAAC,QAAQ,KAAQ,cAAc,CAC/C,OAASC,EAAE,KAAQ,kBAAkB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEtC,cAAe,SAAS,CAAAC,gBAAgBA,CAAAC,IAAA,CAAoB,IAAnB,CAAEC,KAAK,CAAEC,MAAO,CAAC,CAAAF,IAAA,CACxD,KAAM,CAACG,aAAa,CAAEC,gBAAgB,CAAC,CAAGf,QAAQ,CAAC,EAAE,CAAC,CACtD,KAAM,CAACgB,WAAW,CAAEC,cAAc,CAAC,CAAGjB,QAAQ,CAAC,CAAC,CAAC,CACjD,KAAM,CAACkB,YAAY,CAAEC,eAAe,CAAC,CAAGnB,QAAQ,CAAC,KAAK,CAAC,CAEvDC,SAAS,CAAC,IAAM,CACd,KAAM,CAAAmB,UAAU,CAAGR,KAAK,EAAIS,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CACzD,GAAI,CAACF,UAAU,CAAE,OAEjB,KAAM,CAAAG,kBAAkB,CAAG,KAAAA,CAAA,GAAY,CACrC,GAAI,CACF,KAAM,CAAAC,GAAG,CAAG,KAAM,CAAAtB,GAAG,CAACuB,GAAG,CAAC,gBAAgB,CAAC,CAC3CV,gBAAgB,CAACS,GAAG,CAACE,IAAI,EAAI,EAAE,CAAC,CAChCT,cAAc,CAAC,CAACO,GAAG,CAACE,IAAI,EAAI,EAAE,EAAEC,MAAM,CAAEC,CAAC,EAAK,CAACA,CAAC,CAACC,MAAM,CAAC,CAACC,MAAM,CAAC,CAClE,CAAE,MAAOC,GAAG,CAAE,CACZC,OAAO,CAACC,KAAK,CAAC,+BAA+B,CAAEF,GAAG,CAAC,CACrD,CACF,CAAC,CAEDR,kBAAkB,CAAC,CAAC,CAEpB,KAAM,CAAAW,aAAa,CAAG,CAAChC,GAAG,CAACiC,QAAQ,EAAIjC,GAAG,CAACiC,QAAQ,CAACC,OAAO,CACvDC,MAAM,CAACnC,GAAG,CAACiC,QAAQ,CAACC,OAAO,CAAC,CAACE,OAAO,CAAC,WAAW,CAAE,EAAE,CAAC,CACrD,EAAE,GAAK,uBAAuB,CAElC,KAAM,CAAAC,MAAM,CAAGlC,EAAE,CAAC6B,aAAa,CAAC,CAEhCK,MAAM,CAACC,EAAE,CAAC,SAAS,CAAE,IAAM,CACzB,GAAI,CAAAC,GAAG,CAAG5B,MAAM,CAChB,GAAI,CAAC4B,GAAG,CAAE,CACR,GAAI,CACF,KAAM,CAAAC,CAAC,CAAGrB,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CACtCmB,GAAG,CAAGC,CAAC,CAAGC,IAAI,CAACC,KAAK,CAACF,CAAC,CAAC,CAACG,GAAG,EAAIF,IAAI,CAACC,KAAK,CAACF,CAAC,CAAC,CAACI,EAAE,CAAG,IAAI,CACxD,CAAE,MAAOC,CAAC,CAAE,CACVN,GAAG,CAAG,IAAI,CACZ,CACF,CACA,GAAIA,GAAG,CAAEF,MAAM,CAACS,IAAI,CAAC,UAAU,CAAEP,GAAG,CAAC,CACvC,CAAC,CAAC,CAEFF,MAAM,CAACC,EAAE,CAAC,iBAAiB,CAAGS,YAAY,EAAK,CAC7ClC,gBAAgB,CAAEmC,IAAI,EAAK,CAACD,YAAY,CAAE,GAAGC,IAAI,CAAC,CAAC,CACnDjC,cAAc,CAAEiC,IAAI,EAAKA,IAAI,CAAG,CAAC,CAAC,CACpC,CAAC,CAAC,CAEF,MAAO,IAAMX,MAAM,CAACY,UAAU,CAAC,CAAC,CAClC,CAAC,CAAE,CAACvC,KAAK,CAAEC,MAAM,CAAC,CAAC,CAEnB,KAAM,CAAAuC,UAAU,CAAG,KAAO,CAAAN,EAAE,EAAK,CAC/B,GAAI,CACF,KAAM,CAAA5C,GAAG,CAACmD,GAAG,mBAAAC,MAAA,CAAmBR,EAAE,SAAO,CAAC,CAC1C/B,gBAAgB,CAAEmC,IAAI,EACpBA,IAAI,CAACK,GAAG,CAAE3B,CAAC,EAAMA,CAAC,CAACiB,GAAG,GAAKC,EAAE,CAAAU,aAAA,CAAAA,aAAA,IAAQ5B,CAAC,MAAEC,MAAM,CAAE,IAAI,GAAKD,CAAE,CAC7D,CAAC,CACDX,cAAc,CAAEiC,IAAI,EAAKO,IAAI,CAACC,GAAG,CAAC,CAAC,CAAER,IAAI,CAAG,CAAC,CAAC,CAAC,CACjD,CAAE,MAAOnB,GAAG,CAAE,CACZC,OAAO,CAACC,KAAK,CAAC,qCAAqC,CAAEF,GAAG,CAAC,CAC3D,CACF,CAAC,CAED,KAAM,CAAA4B,uBAAuB,CAAI/B,CAAC,EAAK,CACrC,GAAI,CAACA,CAAC,CAACC,MAAM,CAAEuB,UAAU,CAACxB,CAAC,CAACiB,GAAG,CAAC,CAChC;AACF,CAAC,CAED,mBACEpC,KAAA,QAAKmD,SAAS,CAAC,UAAU,CAAAC,QAAA,eACvBtD,IAAA,CAACH,QAAQ,EACPwD,SAAS,CAAC,sCAAsC,CAChDE,OAAO,CAAEA,CAAA,GAAM3C,eAAe,CAAC,CAACD,YAAY,CAAE,CAC/C,CAAC,CACDF,WAAW,CAAG,CAAC,eACdT,IAAA,SAAMqD,SAAS,CAAC,4GAA4G,CAAAC,QAAA,CACzH7C,WAAW,CACR,CACP,CAEAE,YAAY,eACXX,IAAA,QAAKqD,SAAS,CAAC,+FAA+F,CAAAC,QAAA,CAC3G/C,aAAa,CAACgB,MAAM,GAAK,CAAC,cACzBvB,IAAA,MAAGqD,SAAS,CAAC,2BAA2B,CAAAC,QAAA,CAAC,kBAAgB,CAAG,CAAC,CAE7D/C,aAAa,CAACyC,GAAG,CAAE3B,CAAC,eAClBrB,IAAA,QAEEqD,SAAS,iDAAAN,MAAA,CACP,CAAC1B,CAAC,CAACC,MAAM,CAAG,sBAAsB,CAAG,EAAE,CACtC,CACHiC,OAAO,CAAEA,CAAA,GAAMH,uBAAuB,CAAC/B,CAAC,CAAE,CAAAiC,QAAA,CAEzCjC,CAAC,CAACmC,OAAO,EANLnC,CAAC,CAACiB,GAOJ,CACN,CACF,CACE,CACN,EACE,CAAC,CAEV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}